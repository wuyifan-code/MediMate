<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GALAXY WORKBENCH PRO - 计算机科学名人堂</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- D3.js 核心库 -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/topojson@3.0.2/dist/topojson.min.js"></script>
    <!-- 字体库 -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Orbitron:wght@500;700;900&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+SC:wght@300;400;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-space: #020408;
            --bg-glass: rgba(13, 17, 23, 0.75);
            --bg-glass-heavy: rgba(13, 17, 23, 0.95);

            --border-highlight: rgba(56, 139, 253, 0.5);
            --border-dim: rgba(48, 54, 61, 0.6);

            --neon-blue: #00f2ff;
            --neon-pink: #ff0055;
            --neon-purple: #bc8cff;
            --neon-green: #3fb950;

            --text-main: #e6edf3;
            --text-sub: #8b949e;
        }

        body {
            background-color: var(--bg-space);
            color: var(--text-main);
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
        }

        /* Canvas Starfield */
        #star-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* 顶部栏 */
        .header-bar {
            height: 56px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-glass-heavy);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-dim);
            z-index: 50;
        }

        .brand-logo {
            font-family: 'Orbitron';
            font-size: 1.2rem;
            font-weight: 800;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #fff, var(--neon-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sys-status {
            font-family: 'JetBrains Mono';
            font-size: 0.7rem;
            color: var(--neon-green);
            padding: 4px 8px;
            border: 1px solid rgba(63, 185, 80, 0.3);
            border-radius: 4px;
            background: rgba(63, 185, 80, 0.1);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .blink-dot {
            width: 6px;
            height: 6px;
            background: currentColor;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* 主工作区 */
        .workspace {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* 侧边栏通用样式 */
        .side-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-dim);
            display: flex;
            flex-direction: column;
            width: 320px;
            z-index: 20;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .side-panel.right {
            width: 380px;
            border-right: none;
            border-left: 1px solid var(--border-dim);
        }

        /* 搜索框 */
        .search-area {
            padding: 15px;
            border-bottom: 1px solid var(--border-dim);
        }

        .cyber-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-dim);
            padding: 10px;
            color: white;
            border-radius: 6px;
            font-family: 'Inter';
            transition: 0.3s;
        }

        .cyber-input:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.1);
            outline: none;
        }

        /* 列表项 */
        .list-container {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #30363d transparent;
        }

        .list-container::-webkit-scrollbar {
            width: 4px;
        }

        .list-container::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 2px;
        }

        .scientist-row {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .scientist-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .scientist-row.active {
            background: rgba(0, 242, 255, 0.08);
        }

        .scientist-row.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--neon-blue);
            box-shadow: 2px 0 8px var(--neon-blue);
        }

        .row-avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid var(--border-dim);
        }

        .row-info h4 {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
        }

        .row-info span {
            font-size: 0.75rem;
            color: var(--text-sub);
            display: block;
        }

        .gender-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: auto;
            box-shadow: 0 0 5px currentColor;
        }

        /* 3D地球容器 */
        .globe-stage {
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .globe-stage:active {
            cursor: grabbing;
        }

        /* 地球 SVG 样式 */
        .globe-ocean {
            fill: url(#oceanGradient);
            stroke: none;
        }

        .globe-land {
            fill: rgba(0, 242, 255, 0.15);
            stroke: rgba(0, 242, 255, 0.4);
            stroke-width: 0.5px;
            vector-effect: non-scaling-stroke;
            transition: all 0.3s ease;
        }

        .globe-land:hover {
            fill: rgba(0, 242, 255, 0.4);
            stroke: rgba(0, 242, 255, 0.8);
            filter: drop-shadow(0 0 5px rgba(0, 242, 255, 0.5));
        }

        .graticule {
            fill: none;
            stroke: rgba(0, 242, 255, 0.1);
            stroke-width: 0.5px;
        }

        .marker-point {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .marker-point circle {
            transition: all 0.3s ease;
        }

        .marker-point:hover circle {
            transform: scale(1.5);
        }

        .marker-point text {
            font-size: 12px;
            fill: #fff;
            text-anchor: middle;
            font-family: 'JetBrains Mono';
            text-shadow: 0 0 4px #000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            font-weight: bold;
        }

        .marker-point:hover text {
            opacity: 1;
            transform: translateY(-12px);
        }

        /* 右侧详情卡片 */
        .profile-header {
            position: relative;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-dim);
        }

        .big-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border-highlight);
            padding: 3px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.2);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
        }

        .detail-card {
            margin: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid var(--border-dim);
        }

        .card-title {
            font-size: 0.75rem;
            color: var(--text-sub);
            text-transform: uppercase;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .card-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #d0d7de;
        }

        /* 控制按钮 */
        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 30;
        }

        .ctrl-btn {
            background: rgba(13, 17, 23, 0.8);
            backdrop-filter: blur(4px);
            border: 1px solid var(--border-dim);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: 0.2s;
        }

        .ctrl-btn:hover {
            background: var(--border-highlight);
            border-color: var(--neon-blue);
        }

        /* 移动端菜单按钮 */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* 响应式 */
        @media (max-width: 1024px) {
            .mobile-menu-btn {
                display: block;
            }

            .side-panel {
                position: absolute;
                height: calc(100vh - 56px);
                top: 0;
                left: 0;
                transform: translateX(-100%);
                box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
            }

            .side-panel.active {
                transform: translateX(0);
            }

            .side-panel.right {
                right: 0;
                left: auto;
                transform: translateX(100%);
                border-left: 1px solid var(--border-dim);
            }

            .side-panel.right.active {
                transform: translateX(0);
            }

            /* 遮罩层 */
            .overlay {
                position: fixed;
                top: 56px;
                left: 0;
                width: 100%;
                height: calc(100% - 56px);
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(2px);
                z-index: 15;
                display: none;
            }

            .overlay.active {
                display: block;
            }
        }
    </style>
</head>

<body>

    <canvas id="star-canvas"></canvas>

    <header class="header-bar">
        <div style="display: flex; align-items: center; gap: 15px;">
            <button class="mobile-menu-btn" onclick="app.toggleLeftPanel()">
                <i class="fa fa-bars"></i>
            </button>
            <div class="brand-logo">
                <i class="fa fa-connectdevelop"></i>
                <span>GALAXY<span style="font-weight: 300; opacity: 0.8;">PRO</span></span>
            </div>
        </div>

        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="sys-status">
                <div class="blink-dot"></div>
                LIVE DATA: <span id="count-display">0</span> NODES
            </div>
            <button class="mobile-menu-btn" onclick="app.toggleRightPanel()">
                <i class="fa fa-info-circle"></i>
            </button>
        </div>
    </header>

    <div class="workspace">
        <div class="overlay" id="overlay" onclick="app.closePanels()"></div>

        <!-- 左侧列表 -->
        <aside class="side-panel" id="left-panel">
            <div class="search-area">
                <input type="text" id="search-box" class="cyber-input" placeholder="搜索科学家 / 领域...">
            </div>
            <div class="list-container" id="roster-list">
                <!-- 列表将通过 JS 渲染 -->
            </div>
        </aside>

        <!-- 中间地球 -->
        <main class="globe-stage" id="globe-container">
            <svg id="globe-svg" width="100%" height="100%"></svg>

            <div class="controls">
                <button class="ctrl-btn" onclick="app.resetView()"><i class="fa fa-globe"></i> 重置视角</button>
                <button class="ctrl-btn" onclick="app.toggleRotation()"><i class="fa fa-refresh"></i> <span
                        id="rot-text">暂停自转</span></button>
            </div>
        </main>

        <!-- 右侧详情 -->
        <aside class="side-panel right" id="right-panel">
            <div id="empty-detail"
                style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0.4;">
                <i class="fa fa-mouse-pointer fa-3x" style="margin-bottom: 20px;"></i>
                <p>Select a scientist to view data</p>
            </div>

            <div id="full-detail" style="display: none; height: 100%; overflow-y: auto;">
                <div class="profile-header">
                    <img id="p-img" src="" class="big-avatar">
                    <h2 id="p-name" style="font-size: 1.5rem; font-weight: 700;">Name</h2>
                    <div id="p-title" style="color: var(--neon-blue); font-size: 0.85rem; margin-top: 5px;">Title</div>
                    <div style="margin-top: 10px; font-size: 0.8rem; color: var(--text-sub);">
                        <i class="fa fa-map-marker"></i> <span id="p-loc">Location</span>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="card-title"><i class="fa fa-history"></i> 生平简介</div>
                    <p class="card-text" id="p-bio"></p>
                </div>

                <div class="detail-card">
                    <div class="card-title"><i class="fa fa-code"></i> 核心贡献</div>
                    <p class="card-text" id="p-contrib" style="color: var(--neon-green);"></p>
                </div>

                <div class="detail-card">
                    <div class="card-title"><i class="fa fa-trophy"></i> 历史地位</div>
                    <p class="card-text" id="p-legacy"></p>
                </div>
            </div>
        </aside>
    </div>

    <script>
        /**
         * 数据集
         */
        const SCIENTISTS = [
            { id: "lovelace", name: "Ada Lovelace", title: "第一位程序员", field: "Mathematics", country: "United Kingdom", lat: 51.5074, lng: -0.1278, gender: "f", bio: "19世纪数学家，为巴贝奇分析机编写了第一个算法。", contrib: "预见计算机通用性，编写首个算法", legacy: "编程语言Ada以她命名" },
            { id: "turing", name: "Alan Turing", title: "计算机科学之父", field: "AI / Crypto", country: "United Kingdom", lat: 53.4808, lng: -2.2426, gender: "m", bio: "破译Enigma密码，提出图灵机概念。", contrib: "图灵机，图灵测试，解密Enigma", legacy: "图灵奖，计算机界的诺贝尔奖" },
            { id: "hopper", name: "Grace Hopper", title: "COBOL之母", field: "Programming", country: "USA", lat: 40.7128, lng: -74.0060, gender: "f", bio: "美国海军准将，发明了第一个编译器链接器。", contrib: "开发COBOL语言，发现第一个计算机Bug", legacy: "以她命名的格蕾丝·赫柏庆典" },
            { id: "von_neumann", name: "John von Neumann", title: "现代计算机架构师", field: "Architecture", country: "Hungary", lat: 47.4979, lng: 19.0402, gender: "m", bio: "博弈论创始人，确立了存储程序计算机结构。", contrib: "冯·诺依曼架构，曼哈顿计划", legacy: "所有现代PC的基础架构" },
            { id: "shannon", name: "Claude Shannon", title: "信息论之父", field: "Information Theory", country: "USA", lat: 42.3601, lng: -71.0589, gender: "m", bio: "将布尔代数应用于电路设计，定义了比特(bit)。", contrib: "信息论，数字电路逻辑设计", legacy: "数字通信时代的基石" },
            { id: "berners_lee", name: "Tim Berners-Lee", title: "万维网发明者", field: "Internet", country: "United Kingdom", lat: 51.5074, lng: -0.1278, gender: "m", bio: "在CERN工作期间发明了WWW，HTTP和HTML。", contrib: "发明万维网，W3C创始人", legacy: "改变了人类信息传播方式" },
            { id: "ritchie", name: "Dennis Ritchie", title: "C语言之父", field: "Systems", country: "USA", lat: 40.7128, lng: -74.0060, gender: "m", bio: "创造了C语言和Unix操作系统。", contrib: "C语言，Unix系统", legacy: "C语言是现代编程语言的基石" },
            { id: "thompson", name: "Ken Thompson", title: "Unix共同创造者", field: "Systems", country: "USA", lat: 37.7749, lng: -122.4194, gender: "m", bio: "Unix及B语言作者，Go语言共同作者。", contrib: "Unix，B语言，UTF-8编码，Go语言", legacy: "操作系统设计的典范" },
            { id: "hamilton", name: "Margaret Hamilton", title: "软件工程先驱", field: "Software Eng", country: "USA", lat: 42.3601, lng: -71.0589, gender: "f", bio: "领导编写了阿波罗计划的飞行控制软件。", contrib: "阿波罗登月软件，提出'软件工程'一词", legacy: "NASA杰出太空行动奖" },
            { id: "knuth", name: "Donald Knuth", title: "算法分析之父", field: "Algorithms", country: "USA", lat: 37.4275, lng: -122.1697, gender: "m", bio: "《计算机程序设计艺术》作者，TeX排版系统发明者。", contrib: "算法分析，TeX，Metafont", legacy: "计算机科学的圣经TAOCP" },
            { id: "torvalds", name: "Linus Torvalds", title: "Linux之父", field: "OS / Open Source", country: "Finland", lat: 60.1699, lng: 24.9384, gender: "m", bio: "创建了Linux内核和Git版本控制系统。", contrib: "Linux内核，Git", legacy: "开源运动的标志性人物" },
            { id: "gosling", name: "James Gosling", title: "Java之父", field: "Languages", country: "Canada", lat: 51.0447, lng: -114.0719, gender: "m", bio: "在Sun Microsystems领导设计了Java语言。", contrib: "Java编程语言，JVM", legacy: "企业级应用最广泛的语言" },
            { id: "stroustrup", name: "Bjarne Stroustrup", title: "C++之父", field: "Languages", country: "Denmark", lat: 56.2639, lng: 10.2039, gender: "m", bio: "在贝尔实验室开发了C++。", contrib: "C++编程语言", legacy: "系统级编程的主流语言" },
            { id: "liskov", name: "Barbara Liskov", title: "程序设计方法论", field: "Systems", country: "USA", lat: 42.3601, lng: -71.0589, gender: "f", bio: "图灵奖得主，提出了里氏替换原则。", contrib: "CLU语言，里氏替换原则(LSP)", legacy: "面向对象设计的核心原则" },
            { id: "hinton", name: "Geoffrey Hinton", title: "深度学习教父", field: "Deep Learning", country: "United Kingdom", lat: 43.6532, lng: -79.3832, gender: "m", bio: "坚持神经网络研究，推动了现代AI爆发。", contrib: "反向传播，玻尔兹曼机，胶囊网络", legacy: "2018图灵奖，AI复兴推手" },
            { id: "lecun", name: "Yann LeCun", title: "CNN之父", field: "AI / Vision", country: "France", lat: 48.8566, lng: 2.3522, gender: "m", bio: "Facebook首席AI科学家，卷积神经网络奠基人。", contrib: "卷积神经网络(CNN)，LeNet", legacy: "计算机视觉的基础" },
            { id: "bengio", name: "Yoshua Bengio", title: "深度学习三巨头", field: "AI", country: "Canada", lat: 45.5017, lng: -73.5673, gender: "m", bio: "蒙特利尔大学教授，生成对抗网络(GAN)的早期推动者。", contrib: "序列模型，注意力机制基础", legacy: "加拿大AI生态的核心" },
            { id: "feifei", name: "Fei-Fei Li", title: "AI民主化先驱", field: "Computer Vision", country: "China", lat: 39.9042, lng: 116.4074, gender: "f", bio: "ImageNet创作者，斯坦福HAI联席主任。", contrib: "ImageNet数据集，计算机视觉识别", legacy: "数据驱动AI的催化剂" },
            { id: "yao", name: "Andrew Yao", title: "算法与加密大师", field: "Theory", country: "China", lat: 31.2304, lng: 121.4737, gender: "m", bio: "首位获得图灵奖的华人，清华交叉信息院院长。", contrib: "姚氏电路，通信复杂性，量子计算", legacy: "华人在CS领域的最高成就" },
            { id: "engelbart", name: "Douglas Engelbart", title: "鼠标发明者", field: "HCI", country: "USA", lat: 37.7749, lng: -122.4194, gender: "m", bio: "人机交互先驱，著名的'演示之母'。", contrib: "鼠标，超文本，协作软件", legacy: "现代图形界面的鼻祖" },
            { id: "cerf", name: "Vint Cerf", title: "互联网之父", field: "Networks", country: "USA", lat: 38.9072, lng: -77.0369, gender: "m", bio: "TCP/IP协议的共同设计者。", contrib: "TCP/IP协议，互联网架构", legacy: "连接了全世界" },
            { id: "khan", name: "Bob Kahn", title: "互联网之父", field: "Networks", country: "USA", lat: 40.7128, lng: -74.0060, gender: "m", bio: "TCP/IP协议共同设计者。", contrib: "TCP/IP协议", legacy: "互联网基础设施" },
            { id: "sutherland", name: "Ivan Sutherland", title: "计算机图形学之父", field: "Graphics", country: "USA", lat: 41.8781, lng: -87.6298, gender: "m", bio: "开发了Sketchpad，第一个图形用户界面。", contrib: "Sketchpad，头戴式显示器原型", legacy: "VR和CAD的先驱" },
            { id: "backus", name: "John Backus", title: "Fortran之父", field: "Languages", country: "USA", lat: 39.9526, lng: -75.1652, gender: "m", bio: "开发了第一种广泛使用的高级编程语言Fortran。", contrib: "Fortran，BNF范式", legacy: "科学计算的基石" },
            { id: "perlman", name: "Radia Perlman", title: "互联网之母", field: "Networks", country: "USA", lat: 42.3601, lng: -71.0589, gender: "f", bio: "发明了生成树协议(STP)。", contrib: "生成树协议(STP)，链路状态路由", legacy: "确保了以太网的可靠性" },
            { id: "lamport", name: "Leslie Lamport", title: "分布式系统大师", field: "Distributed Sys", country: "USA", lat: 40.7128, lng: -74.0060, gender: "m", bio: "LaTeX的作者，分布式系统理论奠基人。", contrib: "Paxos算法，逻辑时钟，LaTeX", legacy: "分布式计算的理论基础" },
            { id: "kay", name: "Alan Kay", title: "面向对象先驱", field: "OOP / HCI", country: "USA", lat: 34.0522, lng: -118.2437, gender: "m", bio: "Smalltalk发明者，提出'Dynabook'概念。", contrib: "面向对象编程，重叠窗口GUI", legacy: "现代笔记本和平板电脑的原型" },
            { id: "widom", name: "Jennifer Widom", title: "数据库专家", field: "Database", country: "USA", lat: 37.4275, lng: -122.1697, gender: "f", bio: "斯坦福工程学院院长，半结构化数据研究先驱。", contrib: "CQL，半结构化数据管理", legacy: "现代数据管理系统" },
            { id: "stonebraker", name: "Michael Stonebraker", title: "现代数据库之父", field: "Database", country: "USA", lat: 42.3601, lng: -71.0589, gender: "m", bio: "Ingres和Postgres的发起人。", contrib: "Ingres, PostgreSQL", legacy: "关系型数据库的演进" }
        ];

        // 补全头像
        SCIENTISTS.forEach(d => {
            if (!d.image) d.image = `https://ui-avatars.com/api/?name=${d.name.replace(' ', '+')}&background=random&color=fff&size=256`;
        });

        /**
         * Canvas Starfield Class
         * 高性能星空背景
         */
        class StarField {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.stars = [];
                this.count = 800;
                this.speed = 0.2;
                this.resize();
                this.init();
                this.animate();

                window.addEventListener('resize', () => this.resize());
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            init() {
                for (let i = 0; i < this.count; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        z: Math.random() * 2, // 深度
                        size: Math.random() * 1.5,
                        opacity: Math.random()
                    });
                }
            }

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                // 绘制背景渐变
                const gradient = this.ctx.createRadialGradient(
                    this.canvas.width / 2, this.canvas.height / 2, 0,
                    this.canvas.width / 2, this.canvas.height / 2, this.canvas.width
                );
                gradient.addColorStop(0, '#050a14');
                gradient.addColorStop(1, '#020408');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                this.ctx.fillStyle = 'white';

                this.stars.forEach(star => {
                    // 移动
                    star.y -= this.speed * (star.z + 0.5);
                    if (star.y < 0) {
                        star.y = this.canvas.height;
                        star.x = Math.random() * this.canvas.width;
                    }

                    // 绘制
                    this.ctx.globalAlpha = star.opacity * (0.5 + Math.sin(Date.now() * 0.001 * star.z) * 0.5);
                    this.ctx.beginPath();
                    this.ctx.arc(star.x, star.y, star.size * star.z, 0, Math.PI * 2);
                    this.ctx.fill();
                });

                this.ctx.globalAlpha = 1;
                requestAnimationFrame(() => this.animate());
            }
        }

        /**
         * Globe Visualization Class
         * D3.js 地球逻辑封装
         */
        class GlobeViz {
            constructor(containerId, data, onSelect) {
                this.container = document.getElementById(containerId);
                this.data = data;
                this.onSelect = onSelect;

                this.width = this.container.clientWidth;
                this.height = this.container.clientHeight;
                this.isRotating = true;
                this.activeScale = 1;

                this.initD3();
                this.setupResize();
                this.startAnimation();
            }

            initD3() {
                this.svg = d3.select("#globe-svg")
                    .attr("viewBox", `0 0 ${this.width} ${this.height}`);

                // 滤镜定义
                const defs = this.svg.append("defs");
                this.createFilters(defs);

                // 投影
                const initScale = Math.min(this.width, this.height) / 2.2;
                this.projection = d3.geoOrthographic()
                    .scale(initScale)
                    .translate([this.width / 2, this.height / 2])
                    .clipAngle(90);

                this.path = d3.geoPath().projection(this.projection);
                this.g = this.svg.append("g");

                // 交互
                this.setupInteraction(initScale);

                // 加载地图
                d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json').then(world => {
                    const countries = topojson.feature(world, world.objects.countries);
                    this.renderGlobe(countries, initScale);
                    this.renderMarkers();
                });
            }

            createFilters(defs) {
                // 海洋渐变
                const oceanGrad = defs.append("radialGradient")
                    .attr("id", "oceanGradient")
                    .attr("cx", "50%").attr("cy", "50%").attr("r", "50%");
                oceanGrad.append("stop").attr("offset", "0%").attr("stop-color", "rgba(0, 242, 255, 0.2)");
                oceanGrad.append("stop").attr("offset", "100%").attr("stop-color", "rgba(0, 242, 255, 0.05)");

                // 全息光晕
                const filter = defs.append("filter").attr("id", "hologramGlow");
                filter.append("feGaussianBlur").attr("stdDeviation", "10").attr("result", "blur");
                const feMerge = filter.append("feMerge");
                feMerge.append("feMergeNode").attr("in", "blur");
                feMerge.append("feMergeNode").attr("in", "SourceGraphic");
            }

            setupInteraction(initScale) {
                // 拖拽旋转
                const drag = d3.drag()
                    .on("start", () => {
                        this.isRotating = false;
                        app.updateRotateBtn(false);
                    })
                    .on("drag", (event) => {
                        const rotate = this.projection.rotate();
                        const k = 75 / this.projection.scale();
                        this.projection.rotate([
                            rotate[0] + event.dx * k,
                            Math.max(-90, Math.min(90, rotate[1] - event.dy * k))
                        ]);
                        this.updateDraw();
                    });

                // 缩放
                const zoom = d3.zoom()
                    .scaleExtent([1, 8])
                    .on("zoom", (event) => {
                        const newScale = initScale * event.transform.k;
                        this.projection.scale(newScale);
                        this.activeScale = event.transform.k;
                        this.updateDraw();
                    });

                this.svg.call(drag).call(zoom).on("dblclick.zoom", null);
            }

            renderGlobe(countries, initScale) {
                // 大气层
                this.g.append("circle")
                    .attr("class", "atmosphere")
                    .attr("cx", this.width / 2).attr("cy", this.height / 2)
                    .attr("r", initScale * 1.05)
                    .attr("fill", "rgba(0, 242, 255, 0.08)")
                    .style("filter", "url(#hologramGlow)");

                // 海洋
                this.g.append("path")
                    .datum({ type: "Sphere" })
                    .attr("class", "globe-ocean")
                    .attr("d", this.path);

                // 经纬网
                this.g.append("path")
                    .datum(d3.geoGraticule())
                    .attr("class", "graticule")
                    .attr("d", this.path);

                // 陆地
                this.g.selectAll(".globe-land")
                    .data(countries.features)
                    .enter().append("path")
                    .attr("class", "globe-land")
                    .attr("d", this.path);
            }

            renderMarkers() {
                this.g.selectAll(".marker-group").remove();

                const markers = this.g.selectAll(".marker-group")
                    .data(this.data)
                    .enter().append("g")
                    .attr("class", "marker-group marker-point")
                    .on("click", (e, d) => {
                        e.stopPropagation(); // 防止触发 drag
                        this.onSelect(d.id);
                    });

                // 脉冲圈
                markers.append("circle")
                    .attr("r", 6)
                    .attr("fill", "none")
                    .attr("stroke", d => d.gender === 'f' ? 'var(--neon-pink)' : 'var(--neon-blue)')
                    .append("animate")
                    .attr("attributeName", "r")
                    .attr("values", "6; 12; 6")
                    .attr("dur", "2s")
                    .attr("repeatCount", "indefinite");

                markers.select("circle").append("animate")
                    .attr("attributeName", "opacity")
                    .attr("values", "1; 0; 1")
                    .attr("dur", "2s")
                    .attr("repeatCount", "indefinite");

                // 实心点
                markers.append("circle")
                    .attr("r", 3)
                    .attr("fill", d => d.gender === 'f' ? 'var(--neon-pink)' : 'var(--neon-blue)')
                    .attr("stroke", "#fff");

                // 文本
                markers.append("text")
                    .attr("y", -10)
                    .text(d => d.name);

                this.updateDraw();
            }

            updateDraw() {
                this.g.selectAll("path").attr("d", this.path);

                // 更新大气层
                const currentScale = this.projection.scale();
                this.g.select(".atmosphere").attr("r", currentScale * 1.05);

                // 更新标记
                const rotate = this.projection.rotate();
                const centerLon = -rotate[0];
                const centerLat = -rotate[1];

                this.g.selectAll(".marker-group").each((d, i, nodes) => {
                    const p = this.projection([d.lng, d.lat]);
                    const distance = d3.geoDistance([d.lng, d.lat], [centerLon, centerLat]);

                    if (!p || distance > 1.57) {
                        d3.select(nodes[i]).style("display", "none");
                    } else {
                        const scaleFactor = 1 / Math.sqrt(this.activeScale);
                        d3.select(nodes[i])
                            .style("display", "block")
                            .attr("transform", `translate(${p[0]}, ${p[1]})`);

                        d3.select(nodes[i]).selectAll("circle")
                            .attr("transform", `scale(${scaleFactor})`);
                    }
                });
            }

            startAnimation() {
                d3.timer(() => {
                    if (this.isRotating) {
                        const r = this.projection.rotate();
                        this.projection.rotate([r[0] + 0.2, r[1]]);
                        this.updateDraw();
                    }
                });
            }

            flyTo(lat, lng) {
                this.isRotating = false;
                app.updateRotateBtn(false);

                const currentR = this.projection.rotate();
                const targetR = [-lng, -lat];
                const currentS = this.projection.scale();
                const targetS = Math.min(this.width, this.height) / 2.2 * 2.5;

                d3.transition()
                    .duration(1500)
                    .tween("rotateAndZoom", () => {
                        const r = d3.interpolate(currentR, targetR);
                        const s = d3.interpolate(currentS, targetS);
                        return t => {
                            this.projection.rotate(r(t));
                            this.projection.scale(s(t));
                            this.activeScale = s(t) / (Math.min(this.width, this.height) / 2.2);
                            this.updateDraw();
                        };
                    });
            }

            reset() {
                this.isRotating = true;
                app.updateRotateBtn(true);
                const targetS = Math.min(this.width, this.height) / 2.2;

                d3.transition().duration(1000).tween("reset", () => {
                    const s = d3.interpolate(this.projection.scale(), targetS);
                    return t => {
                        this.projection.scale(s(t));
                        this.activeScale = 1;
                        this.updateDraw();
                    };
                });
            }

            setupResize() {
                window.addEventListener('resize', () => {
                    this.width = this.container.clientWidth;
                    this.height = this.container.clientHeight;
                    this.svg.attr("viewBox", `0 0 ${this.width} ${this.height}`);

                    const s = Math.min(this.width, this.height) / 2.2;
                    this.projection.translate([this.width / 2, this.height / 2]).scale(s);
                    this.updateDraw();
                });
            }
        }

        /**
         * Main Application Class
         */
        class GalaxyApp {
            constructor() {
                this.viz = null;
                this.stars = null;
                this.activeId = null;
            }

            init() {
                // 初始化星空
                this.stars = new StarField('star-canvas');

                // 初始化地球
                this.viz = new GlobeViz('globe-container', SCIENTISTS, (id) => this.selectScientist(id));

                // 初始化UI
                this.renderList();
                this.setupSearch();
                document.getElementById('count-display').innerText = SCIENTISTS.length;
            }

            renderList(filter = "") {
                const container = document.getElementById('roster-list');
                container.innerHTML = "";
                const f = filter.toLowerCase();

                SCIENTISTS.forEach(item => {
                    if (item.name.toLowerCase().includes(f) || item.field.toLowerCase().includes(f)) {
                        const div = document.createElement('div');
                        div.className = "scientist-row";
                        div.id = `row-${item.id}`;
                        div.onclick = () => this.selectScientist(item.id);
                        div.innerHTML = `
                            <img src="${item.image}" class="row-avatar">
                            <div class="row-info">
                                <h4>${item.name}</h4>
                                <span>${item.field}</span>
                            </div>
                            <div class="gender-dot" style="color: ${item.gender === 'f' ? 'var(--neon-pink)' : 'var(--neon-blue)'}"></div>
                        `;
                        container.appendChild(div);
                    }
                });
            }

            selectScientist(id) {
                this.activeId = id;
                const data = SCIENTISTS.find(d => d.id === id);

                // UI 高亮
                document.querySelectorAll('.scientist-row').forEach(el => el.classList.remove('active'));
                const row = document.getElementById(`row-${id}`);
                if (row) {
                    row.classList.add('active');
                    row.scrollIntoView({ behavior: "smooth", block: "center" });
                }

                // 地球飞向
                this.viz.flyTo(data.lat, data.lng);

                // 显示详情
                this.showDetail(data);

                // 移动端自动关闭左侧栏，打开右侧栏
                if (window.innerWidth <= 1024) {
                    this.closePanels();
                    this.toggleRightPanel();
                }
            }

            showDetail(data) {
                document.getElementById('empty-detail').style.display = 'none';
                const detail = document.getElementById('full-detail');
                detail.style.display = 'block';
                detail.style.animation = 'fadeIn 0.4s ease';

                document.getElementById('p-img').src = data.image;
                document.getElementById('p-name').innerText = data.name;
                document.getElementById('p-title').innerText = data.title;
                document.getElementById('p-loc').innerText = data.country;
                document.getElementById('p-bio').innerText = data.bio;
                document.getElementById('p-contrib').innerText = data.contrib;
                document.getElementById('p-legacy').innerText = data.legacy;

                const color = data.gender === 'f' ? 'var(--neon-pink)' : 'var(--neon-blue)';
                document.getElementById('p-img').style.borderColor = color;
                document.getElementById('p-img').style.boxShadow = `0 0 15px ${color}40`;
            }

            setupSearch() {
                document.getElementById('search-box').addEventListener('input', (e) => {
                    this.renderList(e.target.value);
                });
            }

            toggleRotation() {
                this.viz.isRotating = !this.viz.isRotating;
                this.updateRotateBtn(this.viz.isRotating);
            }

            updateRotateBtn(isRotating) {
                document.getElementById('rot-text').innerText = isRotating ? "暂停自转" : "继续自转";
            }

            resetView() {
                this.viz.reset();
                document.getElementById('empty-detail').style.display = 'flex';
                document.getElementById('full-detail').style.display = 'none';
                document.querySelectorAll('.scientist-row').forEach(el => el.classList.remove('active'));
            }

            // 移动端面板控制
            toggleLeftPanel() {
                document.getElementById('left-panel').classList.toggle('active');
                document.getElementById('overlay').classList.toggle('active');
                document.getElementById('right-panel').classList.remove('active');
            }

            toggleRightPanel() {
                document.getElementById('right-panel').classList.toggle('active');
                document.getElementById('overlay').classList.toggle('active');
                document.getElementById('left-panel').classList.remove('active');
            }

            closePanels() {
                document.getElementById('left-panel').classList.remove('active');
                document.getElementById('right-panel').classList.remove('active');
                document.getElementById('overlay').classList.remove('active');
            }
        }

        // 启动应用
        const app = new GalaxyApp();
        window.onload = () => app.init();

        // 注入动画样式
        const style = document.createElement('style');
        style.innerHTML = `@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }`;
        document.head.appendChild(style);

    </script>
</body>

</html>